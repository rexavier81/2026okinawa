<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 æ²–ç¹© 8 å¤© 7 å¤œä¹‹æ—…</title>
    <style>
        /* --- ç¶²é æ¨£å¼è¨­å®š --- */
        body { font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif; background-color: #f0f4f8; margin: 0; padding: 0; color: #333; }
        
        /* é ‚éƒ¨æ¨™é¡Œå€ */
        .header { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px 20px 10px; text-align: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header h1 { margin: 0; font-size: 24px; }
        .header p { margin: 5px 0 0; font-size: 14px; opacity: 0.9; }

        /* æœå°‹èˆ‡ç¯©é¸å€ (é»åœ¨é ‚éƒ¨) */
        .controls-container { background: white; position: sticky; top: 70px; z-index: 99; border-bottom: 1px solid #eee; transition: top 0.3s; }
        
        .search-container { padding: 10px 20px; }
        .search-box { width: 100%; padding: 10px; font-size: 16px; border: 2px solid #eee; border-radius: 20px; outline: none; box-sizing: border-box; background: #f9f9f9; }
        .search-box:focus { border-color: #4facfe; background: white; }

        /* æ—¥æœŸæŒ‰éˆ•å€ */
        .filter-container { overflow-x: auto; white-space: nowrap; padding: 10px 15px; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .filter-container::-webkit-scrollbar { display: none; }
        
        /* æŒ‰éˆ•æ¨£å¼ */
        .filter-btn { 
            display: inline-flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 5px 12px; margin-right: 6px; border-radius: 12px; border: 1px solid #ddd; 
            background: white; color: #555; cursor: pointer; transition: all 0.2s; 
            vertical-align: middle; min-width: 75px; height: 48px;    
        }
        .filter-btn.active { background: #4facfe; color: white; border-color: #4facfe; box-shadow: 0 2px 5px rgba(79, 172, 254, 0.4); }
        .btn-main { font-size: 15px; font-weight: 800; line-height: 1.1; margin-bottom: 2px; }
        .btn-emoji { font-size: 18px; line-height: 1; margin-bottom: 2px; }
        .btn-sub { font-size: 11px; opacity: 0.85; line-height: 1; white-space: nowrap; }

        /* è¡Œç¨‹å¡ç‰‡å€ */
        .container { max-width: 800px; margin: 0 auto; padding: 10px 20px 100px; }
        
        .day-header { 
            margin-top: 25px; margin-bottom: 15px; padding-left: 10px; 
            border-left: 5px solid #4facfe; 
            display: flex; flex-direction: column; 
            justify-content: center;
        }
        .day-header-top { display: flex; align-items: baseline; }
        .day-header h2 { margin: 0; font-size: 20px; color: #2c3e50; }
        .day-header span.date { font-size: 14px; color: #7f8c8d; font-weight: normal; margin-left: 10px; }
        .day-summary { 
            font-size: 16px; font-weight: bold; color: #333; 
            margin-top: 5px; 
            background: linear-gradient(transparent 60%, #fff3cd 60%); 
            display: inline-block; width: fit-content;
        }

        .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 0px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; gap: 15px; align-items: flex-start; z-index: 2; position: relative; }
        
        .time-box { background: #eef2f7; padding: 8px 4px; border-radius: 8px; text-align: center; width: 65px; flex-shrink: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .t-start { font-size: 15px; font-weight: 800; color: #2c3e50; line-height: 1.2; }
        .t-arrow { font-size: 10px; color: #aaa; margin: 2px 0; }
        .t-end { font-size: 13px; font-weight: 600; color: #7f8c8d; line-height: 1.2; }
        .t-single { font-size: 15px; font-weight: bold; color: #2c3e50; }

        .info-box { flex-grow: 1; }
        .activity { font-size: 17px; font-weight: bold; margin-bottom: 6px; color: #333; line-height: 1.4; }
        .location { font-size: 13px; color: #007bff; margin-bottom: 6px; display: inline-block; text-decoration: none; }
        .location a { color: #007bff; text-decoration: none; border-bottom: 1px dotted #007bff; }
        .note { font-size: 13px; color: #555; background: #fff8e1; padding: 8px; border-radius: 6px; border-left: 3px solid #ffc107; margin-top: 5px; line-height: 1.5; }
        
        .drive-info { text-align: center; font-size: 12px; color: #aaa; padding: 5px 0; display: flex; align-items: center; justify-content: center; gap: 5px; position: relative; z-index: 1; }
        .drive-info::before, .drive-info::after { content: ''; display: block; width: 1px; height: 12px; border-left: 2px dotted #ddd; }

        .img-card { display: block; }
        .responsive-img { width: 100%; height: auto; border-radius: 8px; margin-top: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        .tag { font-size: 11px; padding: 2px 6px; border-radius: 4px; color: white; display: inline-block; margin-right: 5px; vertical-align: text-top; transform: translateY(-1px); }
        .tag.flight { background-color: #9b59b6; } 
        .tag.hotel { background-color: #f1c40f; color: #333; }
        .tag.food { background-color: #e74c3c; }
        .tag.play { background-color: #2ecc71; }
        .tag.snack { background-color: #cc2e89; }
        .tag.car { background-color: #5352ed; } 
        .tag.recommendation { background-color: #ff6b81; } 

        /* åº•éƒ¨å°è¦½åˆ—æ¨£å¼ */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 65px; background: white; border-top: 1px solid #eee;
            display: flex; justify-content: space-around; align-items: center; z-index: 2000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05); padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-item { flex: 1; text-align: center; color: #999; font-size: 10px; cursor: pointer; padding: 5px 0; -webkit-tap-highlight-color: transparent; }
        .nav-item.active { color: #4facfe; font-weight: bold; }
        .nav-icon { font-size: 22px; display: block; margin-bottom: 2px; }

        /* ç­æ©Ÿèˆ‡ä½å®¿å¡ç‰‡æ¨£å¼ */
        .info-card-container { display: none; padding: 10px 20px 100px; }
        .static-card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; overflow: hidden; }
        .static-card h3 { margin: 0 0 10px; color: #2c3e50; font-size: 18px; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        .static-card .row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
        .static-card .label { color: #888; font-weight: bold; }
        .static-card .val { color: #333; text-align: right; font-weight: 500; }
        .static-card .highlight { color: #4facfe; font-weight: bold; }
        .static-card .sub-text { font-size: 12px; color: #999; margin-top: 5px; }
        .flight-line { position: relative; height: 1px; background: #ddd; margin: 15px 0; width: 100%; }
        .flight-icon { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: white; padding: 0 10px; color: #4facfe; font-size: 16px; }
        
        .pdf-btn {
            display: block; width: 100%; text-align: center; background-color: #ff6b81; color: white; 
            padding: 10px 0; margin-top: 15px; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 14px;
            box-shadow: 0 2px 5px rgba(255, 107, 129, 0.3); transition: background 0.2s;
        }
        .pdf-btn:active { transform: scale(0.98); background-color: #ff4757; }

        /* åŒ¯ç‡è¨ˆç®—æ©Ÿæ‡¸æµ®éˆ• */
        .fab-btn {
            position: fixed; bottom: 85px; right: 20px; width: 50px; height: 50px;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; z-index: 1000; transition: transform 0.2s;
        }
        .fab-btn:active { transform: scale(0.9); }
        .fab-btn::after { content: "åŒ¯ç‡"; position: absolute; bottom: 8px; font-size: 8px; color: #fff; font-weight: bold; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }

        .rate-modal {
            position: fixed; bottom: 150px; right: 20px; width: 280px; background: white; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); padding: 20px; z-index: 999;
            display: none; animation: popUp 0.3s ease;
        }
        @keyframes popUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .rate-title { font-size: 16px; font-weight: bold; color: #333; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .close-rate { color: #999; cursor: pointer; font-size: 20px; }
        .input-group { margin-bottom: 12px; }
        .input-group label { display: block; font-size: 12px; color: #666; margin-bottom: 4px; }
        .input-group input { width: 100%; padding: 10px; font-size: 18px; border: 2px solid #eee; border-radius: 8px; box-sizing: border-box; text-align: right; }
        .rate-info { font-size: 11px; color: #888; text-align: right; margin-top: 5px; }

        /* åˆ†å¸³è¡¨æ¨£å¼ */
        .split-container { display: none; padding: 10px 0 100px; }
        .split-input-card { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .split-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .split-row input, .split-row select { padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; flex: 1; box-sizing: border-box; }
        .btn-add { width: 100%; background: #4facfe; color: white; border: none; padding: 10px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; }
        .split-table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .split-table th { background: #f0f4f8; padding: 10px; font-size: 13px; color: #555; text-align: left; }
        .split-table td { padding: 10px; border-bottom: 1px solid #eee; font-size: 14px; color: #333; }
        .btn-del { color: #ff6b81; cursor: pointer; font-weight: bold; border: none; background: none; }
        .summary-card { background: #2c3e50; color: white; padding: 15px; border-radius: 12px; margin-top: 20px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .summary-total { font-size: 14px; opacity: 0.9; margin-bottom: 5px; }
        .summary-final { font-size: 18px; font-weight: bold; color: #f1c40f; margin-top: 10px; padding-top: 10px; border-top: 1px dashed rgba(255,255,255,0.3); }
        .currency-tag { font-size: 10px; padding: 2px 4px; border-radius: 3px; margin-left: 5px; }
        .curr-twd { background: #e1f5fe; color: #0288d1; }
        .curr-jpy { background: #fff3e0; color: #ef6c00; }

    </style>
</head>
<body>

    <div class="header">
        <h1>âœˆï¸ 2026 æ²–ç¹© 8 å¤© 7 å¤œ</h1>
        <p>è¡Œç¨‹å°å¹«æ‰‹</p>
    </div>

    <div id="topControls" class="controls-container">
        <div class="search-container">
            <input type="text" id="searchInput" class="search-box" placeholder="ğŸ” æœå°‹è¡Œç¨‹ (ä¾‹å¦‚ï¼šç‡’è‚‰)...">
        </div>
        <div id="dayFilter" class="filter-container"></div>
    </div>

    <div class="container" id="itineraryContainer"></div>

    <div class="container info-card-container" id="flightsContainer">
        <div class="static-card" style="border-left: 5px solid #4facfe;">
            <h3>ğŸ›« å»ç¨‹èˆªç­ (2/8)</h3>
            <div class="row"><span class="label">èˆªç©ºå…¬å¸</span><span class="val">æ³°åœ‹è¶Šæ·èˆªç©º (VZ568)</span></div>
            <div class="row"><span class="label">èµ·é£›</span><span class="val">14:45 æ¡ƒåœ’æ©Ÿå ´ (T1)</span></div>
            <div class="flight-line"><span class="flight-icon">âœˆï¸</span></div>
            <div class="row"><span class="label">æŠµé”</span><span class="val">17:05 é‚£éœ¸æ©Ÿå ´ (T1)</span></div>
            <div class="sub-text">é£›è¡Œæ™‚é–“ç´„ 1 å°æ™‚ 20 åˆ†</div>
        </div>
        <div class="static-card" style="border-left: 5px solid #ff9a9e;">
            <h3>ğŸ›¬ å›ç¨‹èˆªç­ (2/15)</h3>
            <div class="row"><span class="label">èˆªç©ºå…¬å¸</span><span class="val">ä¸­è¯èˆªç©º (CI121)</span></div>
            <div class="row"><span class="label">èµ·é£›</span><span class="val">11:55 é‚£éœ¸æ©Ÿå ´ (T1)</span></div>
            <div class="flight-line"><span class="flight-icon">âœˆï¸</span></div>
            <div class="row"><span class="label">æŠµé”</span><span class="val">12:35 æ¡ƒåœ’æ©Ÿå ´ (T2)</span></div>
            <div class="sub-text">é£›è¡Œæ™‚é–“ç´„ 1 å°æ™‚ 40 åˆ†</div>
        </div>
    </div>

    <div class="container info-card-container" id="hotelsContainer">
        <div class="static-card">
            <h3>ğŸ¨ Day 1 (2/8)</h3>
            <div class="row"><span class="label">é£¯åº—åç¨±</span><span class="val highlight">é‚£éœ¸å°ç¥¿ç«™å‰ysæ—…é¤¨</span></div>
            <div class="row"><span class="label">è‹±æ–‡</span><span class="val">Ys Inn Naha Oroku Station</span></div>
            <div class="row"><span class="label">Booking ID</span><span class="val">1679344054</span></div>
            <div class="row"><span class="label">å…¥ä½æ—¥æœŸ</span><span class="val">2/8 (æ—¥) - 2/9 (ä¸€)</span></div>
            <div class="row"><span class="label">å‚™è¨»</span><span class="val">å–®è»Œå°ç¥¿ç«™æ—ï¼Œäº¤é€šæ–¹ä¾¿</span></div>
            <a href="hotel_ys.pdf" target="_blank" class="pdf-btn">ğŸ“„ æŸ¥çœ‹è¨‚æˆ¿æ†‘è­‰ (PDF)</a>
        </div>
        <div class="static-card">
            <h3>ğŸ¨ Day 2 (2/9)</h3>
            <div class="row"><span class="label">é£¯åº—åç¨±</span><span class="val highlight">Hotel Resonex Nago</span></div>
            <div class="row"><span class="label">ä¸­æ–‡åç¨±</span><span class="val">åè­·é›·ç´¢ç´å…‹æ–¯é£¯åº—</span></div>
            <div class="row"><span class="label">Booking ID</span><span class="val">H2512173939348054</span></div>
            <div class="row"><span class="label">å…¥ä½æ—¥æœŸ</span><span class="val">2/9 (ä¸€) - 2/10 (äºŒ)</span></div>
            <div class="row"><span class="label">ç‰¹è‰²</span><span class="val">ç§äººæ²™ç˜ï¼Œæ‰€æœ‰æˆ¿é–“é¢æµ·</span></div>
            <a href="hotel_resonex.pdf" target="_blank" class="pdf-btn">ğŸ“„ æŸ¥çœ‹è¨‚æˆ¿æ†‘è­‰ (PDF)</a>
        </div>
        <div class="static-card">
            <h3>ğŸ¨ Day 3 ~ Day 7 (2/10-2/15)</h3>
            <div class="row"><span class="label">é£¯åº—åç¨±</span><span class="val highlight">åˆ»ã®å®¿ é‚£è¦‡</span></div>
            <div class="row"><span class="label">å…¥ä½æ—¥æœŸ</span><span class="val">2/10 (äºŒ) - 2/15 (æ—¥)</span></div>
            <div class="row"><span class="label">å¤©æ•¸</span><span class="val">é€£ä½ 5 æ™š</span></div>
            <div class="row"><span class="label">å‚™è¨»</span><span class="val">å…¥ä½ä»£ç¢¼ï¼šï¼»ä»£æ”¶å–ï¼½<br>å«ç°¡æ˜“å»šæˆ¿ï¼Œé©åˆæ¡è²·è‡ªç…®</span></div>
        </div>
    </div>

    <div class="container split-container" id="splitBillContainer">
        <div style="background:#fff3e0; color:#e65100; padding:10px; border-radius:8px; font-size:13px; margin-bottom:15px; text-align:center;">
            âš ï¸ æç¤ºï¼šè³‡æ–™æœƒè‡ªå‹•å„²å­˜åœ¨é€™æ”¯æ‰‹æ©Ÿè£¡ï¼Œé—œæ‰ç¶²é ä¹Ÿä¸æœƒæ¶ˆå¤±ã€‚
        </div>
        <div class="split-input-card">
            <h3 style="margin-top:0; color:#2c3e50;">ğŸ“ æ–°å¢å¸³ç›®</h3>
            <div class="split-row"><input type="date" id="billDate"><input type="text" id="billItem" placeholder="é …ç›®åç¨±"></div>
            <div class="split-row">
                <select id="billPayer"><option value="å•Ÿç¿”">å…ˆå¢ŠéŒ¢ï¼šå•Ÿç¿”</option><option value="èƒ–èœœèœ‚">å…ˆå¢ŠéŒ¢ï¼šèƒ–èœœèœ‚</option></select>
            </div>
            <div class="split-row"><input type="number" id="billAmount" placeholder="é‡‘é¡"><select id="billCurrency"><option value="TWD">TWD (å°å¹£)</option><option value="JPY">JPY (æ—¥å¹£)</option></select></div>
            <button class="btn-add" onclick="addExpense()">ï¼‹ åŠ å…¥æ¸…å–®</button>
        </div>
        <h3 style="color:#2c3e50; margin-bottom:10px;">ğŸ“‹ å¸³ç›®åˆ—è¡¨</h3>
        <table class="split-table">
            <thead><tr><th width="20%">æ—¥æœŸ</th><th>é …ç›®</th><th width="25%">é‡‘é¡</th><th width="15%">å¢Š</th><th width="10%">åˆª</th></tr></thead>
            <tbody id="expenseListBody"></tbody>
        </table>
        <div class="summary-card" id="splitSummary">
            <div style="margin-bottom:10px;">ğŸ“Š çµ±è¨ˆè³‡è¨Š (åŒ¯ç‡ä¾å³ä¸‹è§’å³æ™‚è¨ˆç®—)</div>
            <div class="summary-total" id="totalDisplay">è¨ˆç®—ä¸­...</div>
            <div class="summary-final" id="finalSettlement">è«‹æ–°å¢å¸³ç›®ä»¥é–‹å§‹è¨ˆç®—</div>
        </div>
        <div style="text-align:center; margin-top:20px;"><button onclick="clearAllExpenses()" style="background:none; color:#e74c3c; border:none; padding:5px; cursor:pointer; text-decoration:underline; font-size:12px;">âš ï¸ æ¸…é™¤æ‰€æœ‰å¸³ç›®</button></div>
    </div>

    <div class="fab-btn" onclick="toggleRateModal()">ğŸ’°</div>
    <div class="rate-modal" id="rateModal">
        <div class="rate-title">ğŸ’± å³æ™‚åŒ¯ç‡æ›ç®— <span class="close-rate" onclick="toggleRateModal()">Ã—</span></div>
        <div class="input-group"><label>ğŸ‡¯ğŸ‡µ æ—¥å¹£ (JPY)</label><input type="number" id="inputJPY" placeholder="è¼¸å…¥æ—¥å¹£" oninput="convert('JPY')"></div>
        <div class="input-group"><label>ğŸ‡¹ğŸ‡¼ å°å¹£ (TWD)</label><input type="number" id="inputTWD" placeholder="è¼¸å…¥å°å¹£" oninput="convert('TWD')"></div>
        <div class="rate-info" id="rateDisplay">æ­£åœ¨è¼‰å…¥åŒ¯ç‡...</div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('itinerary', this)"><span class="nav-icon">ğŸ“…</span>è¡Œç¨‹</div>
        <div class="nav-item" onclick="switchTab('flights', this)"><span class="nav-icon">âœˆï¸</span>ç­æ©Ÿ</div>
        <div class="nav-item" onclick="switchTab('hotels', this)"><span class="nav-icon">ğŸ¨</span>ä½å®¿</div>
    </div>

    <script>
        // â˜…â˜…â˜… æ¯ä¸€å¤©çš„é‡é»æ¨™é¡Œå°ç…§è¡¨ â˜…â˜…â˜…
        const dayHighlights = {
            "Day 1": "æŠµé”æ²–ç¹© & æ°¸æ—ºé‚£éœ¸",
            "Day 2": "ç³»æ»¿é­šå¸‚å ´ & è¬åº§æ¯› & ç‡’è‚‰äº”è‹‘",
            "Day 3": "ç¾éº—æµ·æ°´æ—é¤¨ & å¤å®‡åˆ©å³¶",
            "Day 4": "é¦–é‡ŒåŸ & æ²–ç¹©ç‹åœ‹ & å¥½å¸‚å¤š",
            "Day 5": "å‘½å¾¡åº­è£½é¹½å·¥å»  & æ°¸æ—ºä¾†å®¢å¤¢ (Rycom) & ç¾åœ‹æ‘",
            "Day 6": "æ³¢ä¸Šå®® & PARCO CITY",
            "Day 7": "ç€¨é•·å³¶ & Outlet & åœ‹éš›é€š",
            "Day 8": "å›å®¶"
        };

        const itineraryData = [
            { day: "Day 1", date: "2/8 (æ—¥)", time: "1100-1130", type: "flight", title: "é–‹è»Šå»åœè»Šå ´", location: "Times å¤§åœ’é«˜éµåŒ—è·¯äºŒæ®µåœè»Šå ´", note: "åœè»Š1å¤©100å…ƒï¼Œè½‰æ·é‹é ˜èˆªç«™" },
            { day: "Day 1", date: "2/8 (æ—¥)", time: "1130-1445", type: "flight", title: "è¾¦ç†ç™»æ©Ÿæ‰‹çºŒ", location: "æ¡ƒåœ’æ©Ÿå ´ç¬¬ä¸€èˆªå»ˆ", note: "é ˜èˆªç«™-æ©Ÿå ´ç¬¬ä¸€èˆªå»ˆç«™" },
            { day: "Day 1", date: "2/8 (æ—¥)", time: "1445-1705", type: "flight", title: "é£›æ©Ÿèµ·é£› ğŸ›«", location: "æ¡ƒåœ’æ©Ÿå ´ç¬¬ä¸€èˆªå»ˆ", note: "æ³°åœ‹è¶Šæ·èˆªç©º VZ568ï¼Œé è¨ˆ 17:05 æŠµé”" },
            { day: "Day 1", date: "2/8 (æ—¥)", time: "1705-1805", type: "food play", title: "å‡ºé—œ", location: "é‚£éœ¸æ©Ÿå ´", note: "<a href='https://www.facebook.com/share/r/17zbjUwdwr/?mibextid=wwXIfr' target='_blank'>æ©Ÿå ´ç‚¸åˆé¤è‚‰FBä»‹ç´¹</a>" },
            { day: "Day 1", date: "2/8 (æ—¥)", time: "1805-1840", type: "flight", title: "æ­ä¹˜å–®è»Œå‰å¾€é£¯åº—ã€check in", location: "é‚£éœ¸å°ç¥¿ç«™å‰ysæ—…é¤¨", note: "check in" },
            { day: "Day 1", date: "2/8 (æ—¥)", time: "1840-1940", type: "food", title: "æ™šé¤ï¼šç‰çƒæ–°éºµ é€šå ‚", location: "é€šå ‚ å°ç¥¿æœ¬åº—", note: "ç”·äººéºµ/å¥³äººéºµ" },
            { day: "Day 1", date: "2/8 (æ—¥)", time: "1940-", type: "food play", title: "æ™šé¤ã€è¶…å¸‚æ¡è²·", location: "æ°¸æ—º é‚£éœ¸åº— (Aeon Naha)", note: "æ™šé¤ã€éš¨æ„é€›é€›" },
            { day: "Day 1", date: "2/8 (æ—¥)", time: "1805-1840", type: "hotel", title: "ä½å®¿ï¼šé‚£éœ¸å°ç¥¿ç«™å‰ysæ—…é¤¨", location: "é‚£éœ¸å°ç¥¿ç«™å‰ysæ—…é¤¨", note: "é€€æˆ¿æ™‚é–“ç‚º12:00" },
            { day: "Day 2", date: "2/9 (ä¸€)", time: "1000-1200", type: "food", title: "æ—©åˆé¤ï¼šA&W æ¼¢å ¡", location: "A&W Naha Kanagusuku æˆ– Aeon", note: "ç¶“å…¸ Root Beer" },
            { day: "Day 2", date: "2/9 (ä¸€)", time: "1200-1230", type: "flight", title: "å‰å¾€ç§Ÿè»Šè¡Œ", location: "å–®è»Œï¼šèµ¤å¶ºç«™ (åŒ—å£)", note: "æ­ä¹˜æ¥é§è»Š" },
            // â˜…â˜…â˜… ä¿®æ­£ Google Maps é€£çµæ ¼å¼ â˜…â˜…â˜…
            { day: "Day 2", date: "2/9 (ä¸€)", time: "1230-1330", type: "car", title: "å–è»Š (å¤§æ¦®ç§Ÿè»Š)", location: "å¤§æ¦®ç§Ÿè»Š", note: "<b>ğŸ“¹ <a href='https://www.youtube.com/watch?v=tDy2CliwKS4' target='_blank'>å–®è»Œèµ¤å¶ºç«™ 12:30 æ¥é§æ–¹æ³•</a></b><br><br>ğŸš— <b>è»Šæ¬¾ï¼š</b>Toyota Yaris<br>ğŸ’° <b>è²»ç”¨ï¼š</b>NT$8,400 (ç¾å ´æ”¯ä»˜/æœªå«ä¿éšª)<br>ğŸ“„ <b>å–®è™Ÿï¼š</b>N0209-0215RC4-08<br>ğŸ‘¤ <b>è¨‚è³¼äººï¼š</b>å¾å•Ÿç¿” / 0918-563-811<br><br><span style='color:#e74c3c; font-weight:bold; background-color:#fff0f0; padding:2px 5px; border-radius:4px;'>âš ï¸ è¨˜å¾—å‘ŠçŸ¥ï¼š2/15(æ—¥) 09:30 è¦æ­æ¥é§å»æ©Ÿå ´</span>" },
            { day: "Day 2", date: "2/9 (ä¸€)", time: "1340-1430", type: "food", title: "åˆé¤ï¼šæµ·é®®åƒçˆ†", location: "ç³»æ»¿é­šå¸‚å ´", driveTime: "5åˆ†", note: "æ¨è–¦ç”Ÿé­šç‰‡ã€ç„—çƒ¤é¾è¦" },
            { day: "Day 2", date: "2/9 (ä¸€)", time: "1550-1630", type: "play", title: "è¬åº§æ¯›", location: "è¬åº§æ¯›", driveTime: "80åˆ†", note: "è±¡é¼»å²©æ™¯è§€ (é€™æ®µè·¯è¼ƒé•·)" },
            { day: "Day 2", date: "2/9 (ä¸€)", time: "1700-1730", type: "play", title: "è²·ç¥¨ & ä¼‘æ¯", location: "è¨±ç”°ä¼‘æ¯ç«™", driveTime: "30åˆ†", note: "<span style='color:#e74c3c; font-weight:bold; background-color:#fff0f0; padding:2px 5px; border-radius:4px;'>âš ï¸ è²·æ°´æ—é¤¨é–€ç¥¨</span>ã€<a href='https://www.facebook.com/share/r/183t8dtLbg/?mibextid=wwXIfr' target='_blank'>åƒç‚¸ç‰©</a>" },
            { day: "Day 2", date: "2/9 (ä¸€)", time: "1755-1815", type: "hotel", title: "é£¯åº— Check-in", location: "ãƒ›ãƒ†ãƒ«ãƒªã‚¾ãƒãƒƒã‚¯ã‚¹åè­·", driveTime: "20åˆ†", note: "ç§äººæµ·ç˜æ•£æ­¥ (å¤•é™½å¾ˆç¾)" },
            { day: "Day 2", date: "2/9 (ä¸€)", time: "1830-2030", type: "food", title: "æ™šé¤ï¼šç‡’è‚‰äº”è‹‘", location: "ç‡’è‚‰äº”è‹‘åè­·åº—", driveTime: "10åˆ†", note: "å·²é ç´„ 18:30 (2ä½)ï¼Œå¯é †é€›éš”å£æ¼«ç•«å€‰åº«" },
            { day: "Day 2", date: "2/9 (ä¸€)", time: "2040-", type: "hotel", title: "ä½å®¿ï¼šåè­· Resonex Nago", location: "ãƒ›ãƒ†ãƒ«ãƒªã‚¾ãƒãƒƒã‚¯ã‚¹åè­·", driveTime: "10åˆ†", note: "éš”å¤©æœ‰é£¯åº—æ—©é¤" },
            { day: "Day 3", date: "2/10 (äºŒ)", time: "0830-0930", type: "food", title: "æ—©é¤", location: "ãƒ›ãƒ†ãƒ«ãƒªã‚¾ãƒãƒƒã‚¯ã‚¹åè­·", note: "é£¯åº—æ—©é¤" },
            { day: "Day 3", date: "2/10 (äºŒ)", time: "1000-1330", type: "play", title: "ç¾éº—æµ·æ°´æ—é¤¨", location: "ç¾éº—æµ·æ°´æ—é¤¨", driveTime: "25åˆ†", note: "é»‘æ½®ä¹‹æµ·" },
            { day: "Day 3", date: "2/10 (äºŒ)", time: "1410-1500", type: "food", title: "åˆé¤ï¼šæµ·æ™¯é¤å»³", location: "L LOTA", driveTime: "35åˆ†", note: "å¤å®‡åˆ©å³¶" },
            { day: "Day 3", date: "2/10 (äºŒ)", time: "1500-1630", type: "play", title: "å¤å®‡åˆ©å³¶å·¡ç¦®", location: "<a href='https://www.google.com/maps/search/?api=1&query=å¿ƒå½¢å²©' target='_blank'>å¿ƒå½¢å²©</a>ã€<a href='https://www.google.com/maps/search/?api=1&query=å¤å®‡åˆ©æµ·æ´‹å¡”-åœè»Šå ´' target='_blank'>å¤å®‡åˆ©æµ·æ´‹å¡”-åœè»Šå ´</a>", driveTime: "10åˆ†", note: "æ²™ç˜ã€æ©‹é ­æ‹ç…§" },
            { day: "Day 3", date: "2/10 (äºŒ)", time: "1800-1900", type: "food", title: "æ™šé¤ / ä¸‹åˆèŒ¶", location: "BANTA CAFE", driveTime: "80åˆ†", note: "çœ‹å¤œæ™¯ã€‚<a href='https://www.facebook.com/share/r/1U1gyWhzTa/?mibextid=wwXIfr' target='_blank'>FBä»‹ç´¹</a> (å›ç¨‹è¼ƒé ï¼Œé æŠ“1.5hr)" },
            { day: "Day 3", date: "2/10 (äºŒ)", time: "2020-", type: "hotel", title: "é£¯åº— Check-inï¼šåˆ»ã®å®¿ é‚£è¦‡", location: "åœè»Šï¼šæ²–ç¸„çœŒæ¨‹å·ç«‹ä½“é§è»Šå ´", driveTime: "50åˆ†", note: "å…¥ä½ä»£ç¢¼ï¼šï¼»ä»£æ”¶ï¼½ã€è²·éš”å¤©æ—©é¤" },
            { day: "Day 4", date: "2/11 (ä¸‰)", time: "0900-0930", type: "food", title: "æ—©é¤", location: "åˆ»ã®å®¿ é‚£è¦‡", note: "" },
            { day: "Day 4", date: "2/11 (ä¸‰)", time: "0950-1130", type: "play", title: "å¤è¹Ÿå·¡ç¦®", location: "é¦–é‡ŒåŸå…¬åœ’", driveTime: "20åˆ†", note: "" },
            { day: "Day 4", date: "2/11 (ä¸‰)", time: "1150-1250", type: "food", title: "åˆé¤", location: "æ°¸æ—ºåŸ å—åŸå¤§é‡Œ", driveTime: "30åˆ†", note: "" },
            { day: "Day 4", date: "2/11 (ä¸‰)", time: "1300-1530", type: "play", title: "æ²–ç¹©ä¸–ç•Œæ–‡åŒ–ç‹åœ‹", location: "æ²–ç¹©ä¸–ç•Œåœè»Šå ´", driveTime: "10åˆ†", note: "ç‰æ³‰æ´ã€ç‹åœ‹æ‘ï¼›14:30 å¤ªé¼“èˆç§€ã€æ³¢ä¼¯è›‡åœ’" },
            { day: "Day 4", date: "2/11 (ä¸‰)", time: "1600-1730", type: "play", title: "å¥½å¸‚å¤šæ¡è³¼", location: "Costco æ²–ç¹©å—åŸå€‰åº«åº—", driveTime: "15åˆ†", note: "è²·è‰è“ï¼" },
            { day: "Day 4", date: "2/11 (ä¸‰)", time: "1750-1845", type: "play", title: "æ©Ÿèƒ½æœé£¾", location: "WORKMAN Yaese", driveTime: "15åˆ†", note: "ãƒ¯ãƒ¼ã‚¯ãƒãƒ³ å…«é‡ç€¬åº—" },
            { day: "Day 4", date: "2/11 (ä¸‰)", time: "1905-2005", type: "food", title: "æ™šé¤ï¼šå’–å“©é£¯", location: "CoCo Ichibanya Round 1 å—é¢¨åŸåº—", driveTime: "15åˆ†", note: "Round 1 å—é¢¨åŸåº—" },
            { day: "Day 4", date: "2/11 (ä¸‰)", time: "2030-", type: "hotel", title: "è¿”å›ä½å®¿ï¼šåˆ»ã®å®¿ é‚£è¦‡", location: "æ²–ç¸„çœŒæ¨‹å·ç«‹ä½“é§è»Šå ´", driveTime: "25åˆ†", note: "" },
            { day: "Day 5", date: "2/12 (å››)", time: "0830-0930", type: "food", title: "æ—©é¤ï¼šæ²–ç¹©éºµ", location: "STAND EIBUN", note: "æ­¥è¡Œ4åˆ†é˜ã€‚å¿…é»ï¼šäºç‘Ÿéºµ (Arthur Soba)ã€å’–å“©éºµ" },
            { day: "Day 5", date: "2/12 (å››)", time: "1040-1140", type: "play", title: "çµ•æ™¯å…œé¢¨", location: "æµ·ä¸­é“è·¯ & æœå ±æ‡¸å´–", driveTime: "60åˆ†", note: "åƒè§€å‘½å¾¡åº­è£½é¹½å·¥å» " },
            { day: "Day 5", date: "2/12 (å››)", time: "1210-1240", type: "snack", title: "é»å¿ƒï¼šç« é­šç‡’", location: "æ²–ç¸„ã‚¤ã‚¤ãƒ€ã‚³å±‹å¤ªé™½", driveTime: "20åˆ†", note: "<a href='https://www.facebook.com/reel/1540297270440381' target='_blank'>FBé€£çµä»‹ç´¹</a>" },
            { day: "Day 5", date: "2/12 (å››)", time: "1300-1630", type: "food play", title: "åˆé¤", location: "æ°¸æ—ºå¤¢æ¨‚åŸä¾†å®¢å¤¢ (Rycom)", driveTime: "20åˆ†", note: "Porteråœ¨SAC'S BAR Resort" },
            { day: "Day 5", date: "2/12 (å››)", time: "1700-2000", type: "food play", title: "ç¾åœ‹æ‘ & æ™šé¤", location: "ç¾åœ‹æ‘ American Village", driveTime: "20åˆ†", note: "åœè»Šï¼šåŒ—è°·ç”ºç‡Ÿæˆ– Depot Islandã€‚åƒï¼šTaco Rice Cafe, è±¬è‚‰è›‹é£¯ç³°" },
            { day: "Day 5", date: "2/12 (å››)", time: "2100-", type: "hotel", title: "è¿”å›ä½å®¿ï¼šåˆ»ã®å®¿ é‚£è¦‡", location: "æ²–ç¸„çœŒæ¨‹å·ç«‹ä½“é§è»Šå ´", driveTime: "40åˆ†", note: "" },
            { day: "Day 6", date: "2/13 (äº”)", time: "0930-1000", type: "play", title: "è³æ«»", location: "èˆ‡å„€å…¬åœ’", note: "æ­¥è¡Œ 6 åˆ†é˜" },
            { day: "Day 6", date: "2/13 (äº”)", time: "1015-1115", type: "food", title: "æ—©é¤ï¼šæµ·é®®", location: "æ³Šæ¸¯æ¼å¸‚å ´", driveTime: "15åˆ†", note: "" },
            { day: "Day 6", date: "2/13 (äº”)", time: "1130-1230", type: "play", title: "åƒæ‹œ", location: "æ³¢ä¸Šå®®", driveTime: "10åˆ†", note: "åœé™„è¿‘ä»˜è²»åœè»Šå ´" },
            { day: "Day 6", date: "2/13 (äº”)", time: "1250-1320", type: "snack", title: "ç”œé»", location: "Cream D Omoromachi", driveTime: "15åˆ†", note: "<a href='https://www.facebook.com/reel/845741431632238' target='_blank'>FBä»‹ç´¹</a>ï¼šç”Ÿç”œç”œåœˆ" },
            { day: "Day 6", date: "2/13 (äº”)", time: "1340-1440", type: "play", title: "æ‹ç…§é€›è¡—", location: "æ¸¯å·å¤–äººä½å®…", driveTime: "20åˆ†", note: "" },
            { day: "Day 6", date: "2/13 (äº”)", time: "1450-1930", type: "food play", title: "åˆé¤+è³¼ç‰©å¤§æˆ°", location: "PARCO CITY", driveTime: "10åˆ†", note: "æ•˜æ•˜è‹‘(3F)ã€æ¼¢å ¡æ’(2F)ã€Porter(1F HANDSå…§)ã€é³¥ç‰" },
            { day: "Day 6", date: "2/13 (äº”)", time: "1945-2045", type: "play", title: "é‹å‹•ç”¨å“", location: "Sports Depo å¤©ä¹…åº—", driveTime: "10åˆ†", note: "é‹å‹•é‹" },
            { day: "Day 6", date: "2/13 (äº”)", time: "2100-", type: "food", title: "æ™šé¤ï¼šçƒˆç«ãƒ©ãƒ¼ãƒ¡ãƒ³æš–æš®", location: "æ²–ç¸„çœŒæ¨‹å·ç«‹ä½“é§è»Šå ´", driveTime: "15åˆ†", note: "åœ¨è³¼ç‰©ä¸­å¿ƒåƒæˆ–é–‹è»Šå›å»åƒæ‹‰éºµ(ç‡Ÿæ¥­åˆ°2:00a.m.)" },
            { day: "Day 7", date: "2/14 (å…­)", time: "0900-1010", type: "food", title: "æ—©é¤ï¼šå¸‚å ´å·¡ç¦®", location: "ç‰§å¿—å…¬è¨­å¸‚å ´", note: "æ­¥è¡Œ 10 åˆ†é˜" },
            { day: "Day 7", date: "2/14 (å…­)", time: "1040-1140", type: "play", title: "çœ‹é£›æ©Ÿ/æµ·æ™¯", location: "ç€¨é•·å³¶ Umikaji Terrace", driveTime: "25åˆ†", note: "" },
            { day: "Day 7", date: "2/14 (å…­)", time: "1200-1700", type: "food play", title: "Outlet è³¼ç‰© & åˆé¤ (iias æ²–ç¹©è±å´)", location: "Ashibinaa Outlet", driveTime: "15åˆ†", note: "é€›ï¼šBEAMS, United Arrows, Porter (GRAN SAC'S)<br>åˆé¤ï¼šæ²–ç¹©èœåœ’ Karakara (<a href='https://www.facebook.com/reel/1424317575868459' target='_blank'>FBä»‹ç´¹</a> æ²–ç¹©é“åœ°ç¾é£Ÿåƒåˆ°é£½)" },
            { day: "Day 7", date: "2/14 (å…­)", time: "1745-2030", type: "food", title: "åœ‹éš›é€š", location: "æ²–ç¸„çœŒæ¨‹å·ç«‹ä½“é§è»Šå ´", driveTime: "30åˆ†", note: "è»Šå…ˆåœå›åœè»Šå ´ã€‚æ™šé¤ï¼š<a href='https://maps.app.goo.gl/yyxXqMyGrGqCKntVA' target='_blank'>é˜¿å¤è±¬ç«é‹ (TRITON)</a> æˆ– <a href='https://www.facebook.com/share/r/17mmY4VG4P/?mibextid=wwXIfr' target='_blank'>æ²–ç¸„æ–™ç†å±…é…’å±‹ ã¶ã£ãŸ å›½éš›é€šã‚Šåº—</a>" },
            { day: "Day 7", date: "2/14 (å…­)", time: "2100-", type: "hotel", title: "è¿”å›ä½å®¿ï¼šåˆ»ã®å®¿ é‚£è¦‡", location: "åˆ»ã®å®¿ é‚£è¦‡", note: "æ”¶è¡Œæ" },
            { day: "Day 8", date: "2/15 (æ—¥)", time: "0730-0800", type: "food", title: "æ—©é¤ / é€€æˆ¿", location: "è¶…å•† / é£¯åº—", note: "æª¢æŸ¥è¡Œæ" },
            { day: "Day 8", date: "2/15 (æ—¥)", time: "0800-0900", type: "car", title: "å‰å¾€å¤§æ¦®ç§Ÿè»Š", location: "å¤§æ¦®ç§Ÿè»Š", driveTime: "20åˆ†", note: "åŠ æ²¹ & é‚„è»Š" },
            { day: "Day 8", date: "2/15 (æ—¥)", time: "0930-1155", type: "flight", title: "è¾¦ç†ç™»æ©Ÿæ‰‹çºŒ", location: "é‚£éœ¸æ©Ÿå ´åœ‹éš›ç·šèˆªå»ˆ", driveTime: "15åˆ†", note: "æ­ä¹˜æ¥é§è»Š" },
            { day: "Day 8", date: "2/15 (æ—¥)", time: "1155-1235", type: "flight", title: "é£›æ©Ÿèµ·é£› ğŸ›«", location: "é‚£éœ¸æ©Ÿå ´åœ‹éš›ç·šèˆªå»ˆ", note: "è¯èˆª CI121ï¼ŒæŠµé”æ¡ƒåœ’æ©Ÿå ´ç¬¬äºŒèˆªå»ˆ" },
            { day: "æ²–ç¹©æ¨è–¦", type: "recommendation", title: "ğŸ æ²–ç¹©é™å®šä¼´æ‰‹ç¦®", image: "pic_souvenir.jpg" },
            { day: "æ²–ç¹©æ¨è–¦", type: "recommendation", title: "ğŸ¥— ç´ é£Ÿ / ç²¾é¸é¤å»³", image: "pic_food.jpg" },
            { day: "æ²–ç¹©æ¨è–¦", type: "recommendation", title: "ğŸ›ï¸ iias æ²–ç¹©è±å´ æ”»ç•¥", image: "pic_iias.jpg" },
            { day: "æ²–ç¹©æ¨è–¦", type: "recommendation", title: "ğŸ›ï¸ PARCO CITY æ”»ç•¥", image: "pic_parco.jpg" },
            { day: "æ²–ç¹©æ¨è–¦", type: "recommendation", title: "ğŸ›ï¸ æ°¸æ—ºå¤¢æ¨‚åŸä¾†å®¢å¤¢ æ”»ç•¥", image: "pic_aeon.jpg" }
        ];

        const container = document.getElementById('itineraryContainer');
        const splitContainer = document.getElementById('splitBillContainer');
        const filterContainer = document.getElementById('dayFilter');
        const searchInput = document.getElementById('searchInput');
        const topControls = document.getElementById('topControls');

        // â˜…â˜…â˜… åŒ¯ç‡èˆ‡åˆ†å¸³é‚è¼¯ â˜…â˜…â˜…
        let currentRate = 0.22; 
        async function fetchRate() {
            try {
                const res = await fetch('https://api.exchangerate-api.com/v4/latest/JPY');
                const data = await res.json();
                currentRate = data.rates.TWD;
                document.getElementById('rateDisplay').innerText = `1 æ—¥å¹£ â‰ˆ ${currentRate.toFixed(3)} å°å¹£ (å³æ™‚)`;
                renderExpenses(); 
            } catch (e) {
                document.getElementById('rateDisplay').innerText = `é è¨­åŒ¯ç‡: 0.22 (ç¶²è·¯ç•°å¸¸)`;
            }
        }

        let expenses = JSON.parse(localStorage.getItem('okinawa_expenses')) || [];

        function addExpense() {
            const date = document.getElementById('billDate').value;
            const item = document.getElementById('billItem').value;
            const payer = document.getElementById('billPayer').value;
            const amount = parseFloat(document.getElementById('billAmount').value);
            const currency = document.getElementById('billCurrency').value;

            if (!date || !item || !amount) { alert("è«‹å¡«å¯«å®Œæ•´è³‡è¨Šå–”ï¼"); return; }
            expenses.push({ date, item, payer, amount, currency });
            expenses.sort((a, b) => new Date(a.date) - new Date(b.date));
            localStorage.setItem('okinawa_expenses', JSON.stringify(expenses));
            document.getElementById('billItem').value = '';
            document.getElementById('billAmount').value = '';
            renderExpenses();
        }

        function deleteExpense(index) {
            if(confirm("ç¢ºå®šè¦åˆªé™¤é€™ç­†å¸³ç›®å—ï¼Ÿ")) {
                expenses.splice(index, 1);
                localStorage.setItem('okinawa_expenses', JSON.stringify(expenses));
                renderExpenses();
            }
        }

        function clearAllExpenses() {
            if(confirm("âš ï¸ ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è¨˜å¸³è³‡æ–™å—ï¼Ÿç„¡æ³•å¾©åŸå–”ï¼")) {
                expenses = [];
                localStorage.setItem('okinawa_expenses', JSON.stringify(expenses));
                renderExpenses();
            }
        }

        function renderExpenses() {
            const tbody = document.getElementById('expenseListBody');
            tbody.innerHTML = '';
            let totalTWD = 0; let paidByA = 0; let paidByB = 0; 
            expenses.forEach((ex, index) => {
                let amountInTWD = ex.currency === 'TWD' ? ex.amount : (ex.amount * currentRate);
                if (ex.payer === 'å•Ÿç¿”') paidByA += amountInTWD; else paidByB += amountInTWD;
                totalTWD += amountInTWD;
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${ex.date.slice(5)}</td><td>${ex.item}</td><td>${ex.amount.toLocaleString()} <span class="currency-tag ${ex.currency === 'TWD' ? 'curr-twd' : 'curr-jpy'}">${ex.currency}</span></td><td>${ex.payer}</td><td><button class="btn-del" onclick="deleteExpense(${index})">Ã—</button></td>`;
                tbody.appendChild(tr);
            });
            const perPerson = totalTWD / 2;
            const diff = paidByA - paidByB; 
            const settlementAmount = Math.abs(diff / 2).toFixed(0);
            document.getElementById('totalDisplay').innerHTML = `ç¸½èŠ±è²»ï¼š<b>$${totalTWD.toFixed(0)}</b> (æ¯äººåˆ†æ”¤ $${perPerson.toFixed(0)})<br>å•Ÿç¿”å·²ä»˜ï¼š$${paidByA.toFixed(0)} | èƒ–èœœèœ‚å·²ä»˜ï¼š$${paidByB.toFixed(0)}`;
            let finalMsg = "";
            if (Math.abs(diff) < 1) finalMsg = "ğŸ‰ å…©ä½ä»˜å¾—å‰›å‰›å¥½ï¼Œä¸ç”¨çµ¦éŒ¢ï¼";
            else if (diff > 0) finalMsg = `ğŸ‘‰ èƒ–èœœèœ‚ è¦çµ¦ å•Ÿç¿” <span style="color:#ff6b81">$${settlementAmount}</span>`;
            else finalMsg = `ğŸ‘‰ å•Ÿç¿” è¦çµ¦ èƒ–èœœèœ‚ <span style="color:#ff6b81">$${settlementAmount}</span>`;
            document.getElementById('finalSettlement').innerHTML = finalMsg;
        }

        function toggleRateModal() {
            const modal = document.getElementById('rateModal');
            if (modal.style.display === 'block') { modal.style.display = 'none'; } 
            else { modal.style.display = 'block'; fetchRate(); }
        }

        function convert(type) {
            const jpyInput = document.getElementById('inputJPY');
            const twdInput = document.getElementById('inputTWD');
            if (type === 'JPY') {
                const jpy = parseFloat(jpyInput.value);
                if (!isNaN(jpy)) twdInput.value = Math.round(jpy * currentRate); else twdInput.value = '';
            } else {
                const twd = parseFloat(twdInput.value);
                if (!isNaN(twd)) jpyInput.value = Math.round(twd / currentRate); else jpyInput.value = '';
            }
        }

        // --- æ ¸å¿ƒé‚è¼¯ ---

        function initFilters() {
            const dayMap = new Map();
            itineraryData.forEach(item => { if (!dayMap.has(item.day)) dayMap.set(item.day, item.date); });
            let buttonsHtml = "";
            let isFirst = true;
            let firstDay = "";
            dayMap.forEach((date, day) => {
                const activeClass = isFirst ? "active" : "";
                if(isFirst) { firstDay = day; isFirst = false; }
                let innerHtml = "";
                if (day === "æ²–ç¹©æ¨è–¦") innerHtml = `<span class="btn-emoji">â¤ï¸</span><span class="btn-sub">æ²–ç¹©æ¨è–¦</span>`;
                else if (date) innerHtml = `<span class="btn-main">${day}</span><span class="btn-sub">${date}</span>`;
                else innerHtml = `<span class="btn-main">${day}</span>`;
                buttonsHtml += `<button class="filter-btn ${activeClass}" onclick="switchTab('itinerary', this, '${day}')">${innerHtml}</button>`;
            });
            buttonsHtml += `<button class="filter-btn" onclick="showSplitBill(this)"><span class="btn-emoji">ğŸ’°</span><span class="btn-sub">åˆ†å¸³è¡¨</span></button>`;
            filterContainer.innerHTML = buttonsHtml;
            renderByDay(firstDay); 
            document.getElementById('billDate').value = "2026-02-08";
            expenses.sort((a, b) => new Date(a.date) - new Date(b.date));
        }

        window.switchTab = function(tabName, btnElement, day = null) {
            if(tabName !== 'itinerary' && btnElement) { 
                document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
                btnElement.classList.add('active');
            } else if (tabName === 'itinerary') { 
                document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
                document.querySelector('.nav-item:first-child').classList.add('active');
                if(btnElement) {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btnElement.classList.add('active');
                }
            }
            splitContainer.style.display = 'none'; 
            container.style.display = 'none'; 
            document.getElementById('flightsContainer').style.display = 'none'; 
            document.getElementById('hotelsContainer').style.display = 'none'; 
            if (tabName === 'itinerary') {
                container.style.display = 'block'; topControls.style.display = 'block'; 
                if (day) renderByDay(day); 
                else { const firstBtn = filterContainer.querySelector('.filter-btn'); if(firstBtn) firstBtn.click(); }
            } else if (tabName === 'flights') {
                document.getElementById('flightsContainer').style.display = 'block'; topControls.style.display = 'none'; 
            } else if (tabName === 'hotels') {
                document.getElementById('hotelsContainer').style.display = 'block'; topControls.style.display = 'none'; 
            }
        };

        window.showSplitBill = function(btnElement) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');
            container.style.display = 'none';
            document.getElementById('flightsContainer').style.display = 'none';
            document.getElementById('hotelsContainer').style.display = 'none';
            splitContainer.style.display = 'block';
            topControls.style.display = 'block'; 
            fetchRate(); renderExpenses();
        };

        function renderByDay(day) {
            const filtered = itineraryData.filter(item => item.day === day);
            render(filtered);
        }

        function render(data) {
            container.innerHTML = "";
            let currentDay = "";
            if(data.length === 0) { container.innerHTML = "<div style='text-align:center; padding:20px; color:#999;'>æ²’æœ‰ç›¸é—œè¡Œç¨‹</div>"; return; }
            data.forEach(item => {
                if (item.day !== currentDay) {
                    currentDay = item.day;
                    const header = document.createElement('div');
                    header.className = 'day-header';
                    
                    let headerContent = "";
                    
                    if (item.day === 'æ²–ç¹©æ¨è–¦') {
                         headerContent = `<h2>â¤ï¸ ${item.day}</h2>`;
                    } else {
                         headerContent += `<div class="day-header-top"><h2>${item.day} <span class="date">${item.date}</span></h2></div>`;
                         if(dayHighlights[item.day]) {
                            headerContent += `<div class="day-summary">${dayHighlights[item.day]}</div>`;
                         }
                    }
                    header.innerHTML = headerContent;
                    container.appendChild(header);
                }

                if (item.type === 'recommendation') {
                    const card = document.createElement('div');
                    card.className = 'card img-card';
                    card.innerHTML = `<div class="info-box" style="text-align:center;"><div class="activity" style="font-size:18px;margin-bottom:10px;"><span class="tag recommendation">å¿…çœ‹</span>${item.title}</div><img src="${item.image}" class="responsive-img" loading="lazy"></div>`;
                    container.appendChild(card);
                    return; 
                }

                if (item.driveTime) {
                    const driveDiv = document.createElement('div');
                    driveDiv.className = 'drive-info';
                    driveDiv.innerHTML = `ğŸš— è»Šç¨‹ç´„ ${item.driveTime}`;
                    container.appendChild(driveDiv);
                }

                const card = document.createElement('div');
                card.className = 'card';
                let cleanTime = item.time.replace(/(\d{2})(\d{2})/g, '$1:$2').replace('::', ':'); 
                let timeHtml = "";
                if (cleanTime.includes('-') && cleanTime.length > 5) {
                    const times = cleanTime.split('-');
                    if(times[1] && times[1].length > 1) {
                        timeHtml = `<div class="t-start">${times[0]}</div><div class="t-arrow">â–¼</div><div class="t-end">${times[1]}</div>`;
                    } else { timeHtml = `<div class="t-single">${times[0]}</div>`; }
                } else { timeHtml = `<div class="t-single">${cleanTime}</div>`; }
                
                // â˜…â˜…â˜… ä¿®æ­£é»ï¼šä½¿ç”¨æ­£ç¢ºçš„ Google Maps æœå°‹é€£çµæ ¼å¼ â˜…â˜…â˜…
                const mapLink = item.location ? `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.location)}" target="_blank" class="location">ğŸ“ ${item.location}</a>` : "";
                const noteBlock = item.note ? `<div class="note">${item.note}</div>` : "";
                const tagsHtml = item.type.split(' ').map(t => `<span class="tag ${t}">${getTypeName(t)}</span>`).join('');

                card.innerHTML = `<div class="time-box">${timeHtml}</div><div class="info-box"><div class="activity">${tagsHtml} ${item.title}</div><div class="location">${item.location.includes('<a') ? 'ğŸ“ ' + item.location : mapLink}</div>${noteBlock}</div>`;
                container.appendChild(card);
            });
        }

        function getTypeName(type) {
            switch(type) {
                case 'flight': return 'äº¤é€š';
                case 'food': return 'ç”¨é¤';
                case 'play': return 'æ™¯é»/è³¼ç‰©';
                case 'hotel': return 'ä½å®¿';
                case 'snack': return 'é»å¿ƒ';
                case 'car': return 'ç§Ÿé‚„è»Š';
                default: return 'è¡Œç¨‹';
            }
        }

        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            container.style.display = 'block';
            splitContainer.style.display = 'none';
            document.getElementById('flightsContainer').style.display = 'none';
            document.getElementById('hotelsContainer').style.display = 'none';
            const filtered = itineraryData.filter(item => 
                item.title.toLowerCase().includes(term) || 
                (item.location && item.location.toLowerCase().includes(term)) ||
                (item.note && item.note.toLowerCase().includes(term))
            );
            render(filtered);
        });

        initFilters();
    </script>
</body>
</html>
